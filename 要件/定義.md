# 定義

## 盤面入力

あらゆるマインスイーパーに対応するため、一貫した盤面入力方法を定義する。
ユーザーに対しては、明らかに盤面整理に必要ないマスを、あらかじめ排除した上で入力してもらうことを要求する。

### 盤面の構成

壁 : `|` , `-`

- 盤面の外側を囲む壁、四隅については`-`記号を優先して使用する
- この記号が明示されていない面については、以下で説明するように、盤面端であるかどうかが分からないようにUI上で表示する

空白 : `0`

- 解放されている ∧ 数字等のない空白マス

不明 : `?`

- まだ解放されていない ∧ 自分の脳内で**地雷あるかどうか不明**なマス

地雷 : `*`

- まだ解放されていない ∧ 自分の脳内で**地雷であることが確定**しているマス

数字 : `1` ~ `8`

- 周囲8マスにある地雷の数を表す数字が入るマス

### 例示

```text
|?????????????
|?????423?????
|2344??1??4???
|1*2*32112*3**
|1122*10011222
```

```text
---------
|001*???|
|001111?|
|000002?|
|011101?|
|12*222?|
---------

```

## 盤面生成

※ここでいう盤面生成とは、上記の盤面入力をもとに、実際のUI上で盤面を表示することを指し、ゲームの盤面生成とは異なることに注意する。

盤面生成は、上記の盤面入力をもとに以下のようなルールで行う。

- まず、入力された長方形の範囲で盤面を生成する、この時その範囲外はすべての方向において無限に盤面が続いているとみなす
  - 入力時点で明らかに盤面整理に必要な範囲を要求するため、入力された範囲外のマスについて考慮する必要はない
  - ただし、その全てを表示する必要はなく、あくまで入力された盤面のみを表示していればよい
- 壁があると明示されている面については、その壁が盤面端であることが分かるようにUI上で表示する
- 壁が明示されていない面については、盤面端であるかどうかが分からないようにUI上で表示する(霧のようなイメージ)

## 盤面整理

### 枠

ユーザーは、特定の数字マスに対して、数字マスの周囲8マス中に存在している不明マス同士を、上下左右に連続して選択することで枠を作成できる。選択するマス数は1以上である必要がある。

枠は1つの数字マスに対して複数作成可能であり、作成数に上限は設けないが、同一構成の枠は重複作成不可とする。枠の作成は、数字マスをクリックして枠作成モードに入り、マウスボタンを離すことで完了する。

選択された不明マスの集合を1つのグループと定義し、そのグループを囲む外枠を表示したものを「枠」と呼ぶ。

---

#### 理論数

枠には、含まれる地雷マスの推測数を「理論数」として入力できる。理論数は枠内のマス数以下の整数であり、未入力の場合はnullとする。

数字マスにおける理論数の合計がその数字を超える場合、矛盾があると判断し、エラーではなく警告を表示する。警告は無視可能であり、表示したまま操作を続行できる。

理論数をユーザーが入力するものとしているのは、`2.png`の黄緑枠と水色枠の関係のように、一つの数字から複数の枠が作成される場合があり、そういった場合を全て想定し自動で理論数を計算するのは複雑であるため。

理論数は後から編集可能であり、UI上で常に表示されることが望ましい。ただし、理論数がnullの場合は表示しない。

---

#### 表示と仕様

- 枠は作成時に関連付けられた数字マスと紐づけられ、識別しやすい形で可視化される。
- 枠の形状は、選択された不明マスの配置に応じて変化し、枠は1つの連続した領域を形成する。
- 例外として、周囲8マスすべてが不明マスの場合、枠は二重丸のような形状になる。
- 1つのマスに最大8つの枠が関与可能。ただし、実際に発生することは稀であり、特別な配慮は不要と考えられる。
- 枠の表示順序は、枠に含まれるマス数が多いほど外側に表示される。同数の場合は、先に作成された枠が外側に表示される。
- 枠が交差する場合は、上記と同様にマス数が多いほど上レイヤーに表示され、同数の場合は先に作成された枠が上レイヤーに表示される。

### 関係

ある一つの枠について、その枠と異なる枠や数字マス(距離は問わない)との間に、定義される関係を**関係**と呼ぶ。

~追記予定~
